define(["jquery"],function(a){"use strict";function b(b){return a(a("#"+b).html().replace(/^\s+|\s+$/g,""))}function c(b){var c={};return a.each(b,function(a,b){c[b.name]=b.value}),c}function d(b,c){return a.each(c,function(c,d){var e=a("dd ."+c+":first",b);e.length>0&&e.val(d)}),b}function e(b,c){return a.each(c,function(c,d){var e=a("."+c,b);e.data("value",d),e.children().length<2&&e.text(d)}),b}function f(b,c){var d=a(c).parent();return"stash"===d.attr("id")?(b.slot=0,b.room=0):(b.slot=d.data("slot"),b.room=d.data("room")),b}function g(a){var c=b("sessionCardTemplate");return c=e(c,a)}function h(b){var c=a('.uid[data-value="'+b.uid+'"]',".sessionCard").parent();e(c,b)}function i(){a(this).dialog("close").remove()}function j(b){var c={};return a(b).children().each(function(){var b=a(this);c[b.attr("class")]=b.data("value")}),c}function k(a){z.uid=a.data.uid,x.append(g(z)),i.apply(this)}function l(){h(z),i.apply(this)}function m(){}function n(){var b=!0;return A?b=!1:(A=!0,y=a('<div class="t3-mask-loading"><div class="ext-el-mask"></div></div>'),y.appendTo(document.body)),b}function o(){A=!1,"object"==typeof y&&y.remove()}function p(){var b=c(a("form",v).serializeArray());z=b,a.ajax({type:"POST",url:"ajax.php",context:this,params:{},data:{ajaxID:"Sessionplaner",id:a.getUrlVar("id"),tx_sessionplaner:{action:"addSession",session:b}},beforeSend:n,complete:o,success:k})}function q(){var b=c(a("form",w).serializeArray());b.uid=z.uid,z=b,a.ajax({type:"POST",url:"ajax.php",context:this,params:{},data:{ajaxID:"Sessionplaner",id:a.getUrlVar("id"),tx_sessionplaner:{action:"updateSession",session:b}},beforeSend:n,complete:o,success:l})}function r(){var b=j(this);b=f(b,this),z=b,a.ajax({type:"POST",url:"ajax.php",context:this,params:{},data:{ajaxID:"Sessionplaner",id:a.getUrlVar("id"),tx_sessionplaner:{action:"updateSession",session:b}},beforeSend:n,complete:o,success:m})}function s(){v=b("session"),v.dialog({width:440,height:330,modal:!0,buttons:{"Create a session":p,Cancel:i}})}function t(){z=j(this),w=d(b("session"),z),w.dialog({width:440,height:330,modal:!0,buttons:{"Update session":q,Cancel:i}})}function u(){a("#stash, .active td.room").droppable({scope:"sessions",drop:function(b,c){a(c.draggable).css({top:0,left:0}).appendTo(a(this)),r.apply(c.draggable[0])}}),a(".sessionCard").disableSelection().draggable({scope:"sessions",connectToSortable:"#stash",snap:!0,revert:"invalid"})}a.extend({getUrlVars:function(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b},getUrlVar:function(b){return a.getUrlVars()[b]}});var v,w,x,y,z={},A=!1;a(document).ready(function(){a("#actions-document-new").click(s),a(document).on("dblclick",".sessionCard",t),u()})});